{% extends "base.html" %}

{% block title %}Online Demo Results | ChemSchematicResolver{% endblock %}

{% macro display_compound(record, index) %}
  <div id="compound-{{ index }}" class="panel panel-default panel-compound">
    <div class="panel-body">
      {% if record.smiles %}
        <img class="compound-img" src="{{ url_for('depict', smiles=record.smiles) }}">
      {% endif %}
      <div class="compound-meta{% if record.smiles %} has-img{% endif %}">
        {% if record.smiles %}
          <div class="name-container">
            {% if record['name'] %}
              <div>{{ record['name'] }}</div>
            {% endif %}
          </div>
        {% endif %}
        {% if record.labels %}
          <div class="label-container">
            Label candidates:
            {% for label in record.labels %}
              <span class="label label-success">{{ label.value }}</span>
            {% endfor %}
          </div>
        {% endif %}
        {% if record.smiles %}
          <div class="smiles-container">
            SMILES: <code class="smiles-display">{{ record.smiles }}</code>
          </div>
          <div class="btn-group link-container">
            <a href="{{ url_for('mol', smiles=record['smiles']) }}" class="btn btn-link"><i class="glyphicon glyphicon-save"></i> Download MOL</a>
            <a href="http://www.chemspider.com/Search.aspx?q={{ record['smiles'] | urlencode }}" class="btn btn-link"><i class="glyphicon glyphicon-search"></i> Search ChemSpider</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endmacro %}


{% macro display_nmr(nmr) %}
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered">
          {% if 'nucleus' in nmr %}
            <tr>
              <th class="col-xs-3">Nucleus</th>
              <td class="col-xs-9">{{ nmr['nucleus'] }}</td>
            </tr>
          {% endif %}
          {% if 'frequency' in nmr %}
            <tr>
              <th class="col-xs-3">Frequency</th>
              <td>{{ nmr['frequency'] }} {% if 'frequency_units' in nmr %}{{ nmr['frequency_units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'solvent' in nmr %}
            <tr>
              <th class="col-xs-3">Solvent</th>
              <td class="col-xs-9">{{ nmr['solvent'] }}</td>
            </tr>
          {% endif %}
          {% if 'temperature' in nmr %}
            <tr>
              <th class="col-xs-3">Temperature</th>
              <td class="col-xs-9">{{ nmr['temperature'] }} {% if 'temperature_units' in nmr %}{{ nmr['temperature_units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'apparatus' in nmr %}
            <tr>
              <th class="col-xs-3">Apparatus</th>
              <td class="col-xs-9">{{ nmr['apparatus'] }}</td>
            </tr>
          {% endif %}
          {% if 'peaks' in nmr %}
            <tr>
              <th class="col-xs-3">Shifts</th>
              <td class="col-xs-9">
                {% for peak in nmr['peaks'] -%}
                    {%- if not loop.first %},{% endif %}
                    {{ peak['shift'] }}
                    {%- if 'multiplicity' in peak or 'number' in peak or 'coupling' in peak or 'assignment' in peak %}
                      (
                      {% if 'multiplicity' in peak %}{{ peak['multiplicity'] }}{% endif %}
                      {% if 'number' in peak %}{{ peak['number'] }}{% endif %}
                      {% if 'coupling' in peak %}{{ peak['coupling'] }}{% if 'coupling_units' in peak %} {{ peak['coupling_units'] }}{% endif %}{% endif -%}
                      {% if 'assignment' in peak %}{{ peak['assignment'] }}{% endif %}
                      )
                    {%- endif %}
                {%- endfor %}
              </td>
            </tr>
          {% endif %}
        </table>
      </div>
    </div>
{% endmacro %}

{% macro display_ir(ir) %}
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered">
          {% if 'solvent' in ir %}
            <tr>
              <th class="col-xs-3">Solvent</th>
              <td class="col-xs-9">{{ ir['solvent'] }}</td>
            </tr>
          {% endif %}
          {% if 'temperature' in ir %}
            <tr>
              <th class="col-xs-3">Temperature</th>
              <td class="col-xs-9">{{ ir['temperature'] }} {% if 'temperature_units' in ir %}{{ ir['temperature_units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'apparatus' in ir %}
            <tr>
              <th class="col-xs-3">Apparatus</th>
              <td class="col-xs-9">{{ ir['apparatus'] }}</td>
            </tr>
          {% endif %}
          {% if 'peaks' in ir %}
            <tr>
              <th class="col-xs-3">Peaks</th>
              <td class="col-xs-9">
                {% for peak in ir['peaks'] -%}
                    {%- if not loop.first %},{% endif %}
                    {{ peak['value'] }}{% if 'units' in peak %} {{ peak['units'] }}{% endif %}
                    {%- if 'strength' in peak or 'bond' in peak %}
                      (
                      {% if 'strength' in peak %}{{ peak['strength'] }}{% endif %}
                      {% if 'bond' in peak %}{{ peak['bond'] }}{% endif %}
                      )
                    {%- endif %}
                {%- endfor %}
              </td>
            </tr>
          {% endif %}
        </table>
      </div>
    </div>
{% endmacro %}

{% macro display_uvvis(uvvis) %}
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered">
          {% if 'solvent' in uvvis %}
            <tr>
              <th class="col-xs-3">Solvent</th>
              <td class="col-xs-9">{{ uvvis['solvent'] }}</td>
            </tr>
          {% endif %}
          {% if 'temperature' in uvvis %}
            <tr>
              <th class="col-xs-3">Temperature</th>
              <td class="col-xs-9">{{ uvvis['temperature'] }} {% if 'temperature_units' in uvvis %}{{ uvvis['temperature_units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'apparatus' in uvvis %}
            <tr>
              <th class="col-xs-3">Apparatus</th>
              <td class="col-xs-9">{{ uvvis['apparatus'] }}</td>
            </tr>
          {% endif %}
          {% if 'peaks' in uvvis %}
            <tr>
              <th class="col-xs-3">Peaks</th>
              <td class="col-xs-9">
                {% for peak in uvvis['peaks'] -%}
                    {%- if not loop.first %},{% endif %}
                    {{ peak['value'] }}{% if 'units' in peak %} {{ peak['units'] }}{% endif %}
                    {%- if 'extinction' in peak or 'shape' in peak %}
                      (
                      {% if 'shape' in peak %}{{ peak['shape'] }}{% endif %}
                      {% if 'extinction' in peak %}{{ peak['extinction'] }}{% if 'extinction_units' in peak %} {{ peak['extinction_units'] }}{% endif %}{% endif %}
                      )
                    {%- endif %}
                {%- endfor %}
              </td>
            </tr>
          {% endif %}
        </table>
      </div>
    </div>
{% endmacro %}

{% macro display_fl(fl) %}
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered">
          {% if 'value' in fl %}
            <tr>
              <th class="col-xs-3">Value</th>
              <td class="col-xs-9">{{ fl['value'] }}{% if 'units' in fl %} {{ fl['units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'solvent' in fl %}
            <tr>
              <th class="col-xs-3">Solvent</th>
              <td class="col-xs-9">{{ fl['solvent'] }}</td>
            </tr>
          {% endif %}
          {% if 'temperature' in fl %}
            <tr>
              <th class="col-xs-3">Temperature</th>
              <td class="col-xs-9">{{ fl['temperature'] }}{% if 'temperature_units' in fl %} {{ fl['temperature_units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'apparatus' in fl %}
            <tr>
              <th class="col-xs-3">Apparatus</th>
              <td class="col-xs-9">{{ fl['apparatus'] }}</td>
            </tr>
          {% endif %}
        </table>
      </div>
    </div>
{% endmacro %}

{% macro display_mp(mp) %}
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered">
          {% if 'value' in mp %}
            <tr>
              <th class="col-xs-3">Value</th>
              <td class="col-xs-9">{{ mp['value'] }}{% if 'units' in mp %} {{ mp['units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'type' in mp %}
            <tr>
              <th class="col-xs-3">Type</th>
              <td class="col-xs-9">{{ mp['type'] }}</td>
            </tr>
          {% endif %}
          {% if 'solvent' in mp %}
            <tr>
              <th class="col-xs-3">Solvent</th>
              <td class="col-xs-9">{{ mp['solvent'] }}</td>
            </tr>
          {% endif %}
          {% if 'apparatus' in mp %}
            <tr>
              <th class="col-xs-3">Apparatus</th>
              <td class="col-xs-9">{{ mp['apparatus'] }}</td>
            </tr>
          {% endif %}
        </table>
      </div>
    </div>
{% endmacro %}


{% macro display_ep(ep) %}
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered">
          {% if 'value' in ep %}
            <tr>
              <th class="col-xs-3">Value</th>
              <td class="col-xs-9">{{ ep['value'] }}{% if 'units' in ep %} {{ ep['units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'type' in ep %}
            <tr>
              <th class="col-xs-3">Type</th>
              <td class="col-xs-9">{{ ep['type'] }}</td>
            </tr>
          {% endif %}
          {% if 'solvent' in ep %}
            <tr>
              <th class="col-xs-3">Solvent</th>
              <td class="col-xs-9">{{ ep['solvent'] }}</td>
            </tr>
          {% endif %}
          {% if 'temperature' in ep %}
            <tr>
              <th class="col-xs-3">Temperature</th>
              <td class="col-xs-9">{{ ep['temperature'] }}{% if 'temperature_units' in ep %} {{ ep['temperature_units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'apparatus' in ep %}
            <tr>
              <th class="col-xs-3">Apparatus</th>
              <td class="col-xs-9">{{ ep['apparatus'] }}</td>
            </tr>
          {% endif %}
        </table>
      </div>
    </div>
{% endmacro %}

{% macro display_qy(qy) %}
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered">
          {% if 'value' in qy %}
            <tr>
              <th class="col-xs-3">Value</th>
              <td class="col-xs-9">{{ qy['value'] }}</td>
            </tr>
          {% endif %}
          {% if 'solvent' in qy %}
            <tr>
              <th class="col-xs-3">Solvent</th>
              <td class="col-xs-9">{{ qy['solvent'] }}</td>
            </tr>
          {% endif %}
          {% if 'temperature' in qy %}
            <tr>
              <th class="col-xs-3">Temperature</th>
              <td class="col-xs-9">{{ qy['temperature'] }}{% if 'temperature_units' in qy %} {{ qy['temperature_units'] }}{% endif %}</td>
            </tr>
          {% endif %}
          {% if 'apparatus' in qy %}
            <tr>
              <th class="col-xs-3">Apparatus</th>
              <td class="col-xs-9">{{ qy['apparatus'] }}</td>
            </tr>
          {% endif %}
        </table>
      </div>
    </div>
{% endmacro %}


{% block content %}
  <div class="container page-container">
    <div class="row">
      <div class="col-xs-12">
        <div class="pull-right">
          <a class="btn btn-link" href="{{ url_for('results', result_id=job.job_id) }}" data-toggle="tooltip" data-placement="bottom" title="Permanent link to this page">{{ utils.icon('link') }} Permalink</a>
        </div>
        <h1>Online Demo Results</h1>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12">
        {% if not task.failed() and job.result|length and not none_extracted %}
          <div>
            <div class="download-container">
              <div class="download-all btn-group">
                <a href="{{ url_for('api.Jobs_csr_job_resource', job_id=job.job_id) }}" class="download-all btn btn-default">JSON</a>
                <a href="{{ url_for('api.Jobs_csr_job_resource', job_id=job.job_id, format='xml') }}" class="download-all btn btn-default">XML</a>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-8">
                <p class="result-text-bold"> Extraction successful!</p>
                <p>The extracted structures are shown below:</p>
              </div>
            </div>
                <div class="text-muted small text-right">Structure-to-name powered by <a href="http://cactus.nci.nih.gov/chemical/structure">NCI CIR</a></div>
                <div class="text-muted small text-right">SMILES-to-diagram powered by <a href="http://rdkit.org/">rdkit</a></div>
                  <div class="smiles-container">
                    {% for result in job.result %}
                      {{ display_compound(result, loop.index0) }}
                    {% endfor %}
                  </div>

              </div>
        {% elif none_extracted %}
           <div>
             <section class="section section-default">
                <div class="container">
                  <div class="row">
                    <div class="col-sm-4 text-center">
                      <img class="img-about-logo" src="{{ url_for('static', filename='img/failed_resolution.svg') }}">
            {#          <img class="img-about" src="{{ url_for('static', filename='img/chem.svg') }}">#}
                    </div>
                    <div class="col-sm-8 align-middle">
                      <div id="about-text-container">
                        <div class="about-text">
                          <p class="feature-display">
                            <b>ChemSchematicResolver was unable to resolve any structures.</b>
                          </p>
                          <p>
                            Please try uploading an image with greater resolution.
                          </p>

                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </section>

        </div>

        {% elif task.failed() %}
          <p>Job failed</p>
          <p>Job ID: {{ job.job_id }}</p>
          <p>Task output: {{ task}} </p>
          <p>Job output : {{ job.result}} </p>
        {% else %}
        <p><b>ChemSchematicResolver is running!</b> </p>
        <p>Images with multiple diagrams and/or larger molecules will take longer to resolve...</p>
          <div class="progress">
            <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%"></div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    var jobId = '{{ job.job_id }}';
  </script>
  <script src="{{ url_for('static', filename='js/results.js') }}"></script>
{%- endblock scripts %}

